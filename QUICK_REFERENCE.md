#!/usr/bin/env bash

# Quick Reference Commands for HybridCI with Language-Aware Caching

echo "╔════════════════════════════════════════════════════════════════╗"
echo "║ HybridCI Language-Aware Caching - Quick Reference ║"
echo "╚════════════════════════════════════════════════════════════════╝"
echo ""

# Installation & Setup

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "1. INSTALLATION & SETUP"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "# Create virtual environment"
echo "python -m venv venv"
echo ""
echo "# Activate virtual environment"
echo "source venv/bin/activate # Linux/Mac"
echo "venv\\Scripts\\activate # Windows"
echo ""
echo "# Install dependencies"
echo "pip install flask pytest"
echo ""
echo "# Verify setup"
echo "python setup_verify.py"
echo ""

# Running the System

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "2. RUNNING THE SYSTEM"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "# View demo (shows all features)"
echo "python demo_language_aware.py"
echo ""
echo "# Run unit tests"
echo "pytest ci_engine/test_language_aware.py -v"
echo ""
echo "# Start dashboard web server"
echo "python dashboard/app.py"
echo ""
echo "# Access dashboard (after starting server)"
echo "# Open in browser: http://localhost:5000"
echo ""

# Dashboard Routes

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "3. DASHBOARD ROUTES"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "GET / Main dashboard with metrics"
echo "GET /run Run CI pipeline"
echo "GET /runs View run history"
echo "GET /baseline Run baseline (all tests)"
echo "GET /cache-stats Cache statistics dashboard"
echo "GET /cache-stats-api Cache stats API (JSON)"
echo ""

# Python API Usage

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "4. PYTHON API USAGE"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "# Language Detection"
echo "from ci_engine.cache_manager import get_file_language"
echo "lang = get_file_language('src/main.py') # Returns: 'python'"
echo ""
echo "# Run Pipeline (Language-Aware)"
echo "from ci_engine.pipeline_runner import run_pipeline"
echo "result = run_pipeline(TEST_MAP, DEP_GRAPH, language_aware=True)"
echo ""
echo "# Get Language Stats"
echo "from ci_engine.language_utils import get_language_stats"
echo "stats = get_language_stats()"
echo ""
echo "# Get Changed Files by Language"
echo "from ci_engine.change_detector import get_changed_files_by_language"
echo "lang_map, all_files = get_changed_files_by_language()"
echo ""

# File Structure

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "5. PROJECT STRUCTURE"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "HybridCI/"
echo "├── ci_engine/ # Core engine"
echo "│ ├── cache_manager.py # Language-aware caching"
echo "│ ├── change_detector.py # Git change detection"
echo "│ ├── pipeline_runner.py # Main execution logic"
echo "│ ├── language_utils.py # Language utilities (NEW)"
echo "│ ├── test_language_aware.py # Language tests (NEW)"
echo "│ └── ..."
echo "├── dashboard/ # Web dashboard"
echo "│ ├── app.py # Flask app"
echo "│ ├── models.py # Database"
echo "│ ├── static/ # CSS, JS"
echo "│ └── templates/ # HTML pages"
echo "├── LANGUAGE_AWARE_CACHING.md # Language feature guide"
echo "├── README.md # Project docs"
echo "├── demo_language_aware.py # Interactive demo"
echo "└── setup_verify.py # Setup checker"
echo ""

# Cache Structure

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "6. CACHE STRUCTURE"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo ".ci*cache/"
echo "├── <hash> # Standard cache (legacy)"
echo "└── language_aware/"
echo " ├── <hash>\_python.pkl # Python-specific cache"
echo " ├── <hash>\_javascript.pkl # JavaScript cache"
echo " ├── <hash>*<language>.pkl # Per-language caches"
echo " └── <hash>\_map.json # Language distribution"
echo ""

# Database

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "7. DATABASE"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "# View database (requires sqlite3)"
echo "sqlite3 ci.db"
echo ""
echo "# Query runs table"
echo "SELECT * FROM runs ORDER BY id DESC LIMIT 5;"
echo ""
echo "# Check cache hit rate"
echo "SELECT AVG(cache_hit)*100 as hit_rate FROM runs;"
echo ""

# Troubleshooting

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "8. TROUBLESHOOTING"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "# Clear caches"
echo "rm -rf .ci_cache/"
echo ""
echo "# Reset database"
echo "rm ci.db"
echo ""
echo "# Check Python version"
echo "python --version # Should be 3.8+"
echo ""
echo "# Check dependencies"
echo "pip list | grep -E 'Flask|pytest'"
echo ""
echo "# View cache statistics"
echo "curl http://localhost:5000/cache-stats-api | python -m json.tool"
echo ""

# Documentation

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "9. DOCUMENTATION"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "README.md - Project overview"
echo "LANGUAGE_AWARE_CACHING.md - Language feature guide"
echo "IMPLEMENTATION_SUMMARY.md - Implementation details"
echo ""

# Supported Languages

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "10. SUPPORTED LANGUAGES"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "Python, JavaScript, TypeScript, Java, C#, C/C++, Go, Rust,"
echo "Ruby, PHP, Swift, Kotlin, Scala"
echo ""

# Performance Tips

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "11. PERFORMANCE TIPS"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "# Check cache size"
echo "du -sh .ci_cache/"
echo ""
echo "# Monitor cache hits"
echo "# Visit http://localhost:5000/cache-stats"
echo ""
echo "# Check git history"
echo "git log --oneline -10"
echo ""

# Quick Examples

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "12. QUICK START EXAMPLE"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "# 1. Setup"
echo "python -m venv venv"
echo "source venv/bin/activate"
echo "pip install flask pytest"
echo ""
echo "# 2. Verify"
echo "python setup_verify.py"
echo ""
echo "# 3. Demo"
echo "python demo_language_aware.py"
echo ""
echo "# 4. Run"
echo "python dashboard/app.py"
echo ""
echo "# 5. Visit"
echo "# http://localhost:5000"
echo ""

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "✨ Language-Aware Caching for HybridCI is ready!"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
